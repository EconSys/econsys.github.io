function arr(r){for(var a=new Array(r),o=0;r>o;o++)a[o]=0;return a}function arr2(r,a){for(var o=new Array(r),f=0;r>f;)o[f]=arr(a),f+=1;return o}function arraycopy(r,a,o,f,t){for(var i=0;t>i;)o[i+f]=r[i+a],i++}function FindMinimum(r,a,o,f,t,i,v,e){var n=o+2,R=arr(a+1);R[0]=0,arraycopy(f,0,R,1,a);var s=function(a,o,f,t){var i=arr(a);arraycopy(f,1,i,0,a);var v=arr(o),e=r(a,o,i,v);return arraycopy(v,0,t,1,o),e},T=cobylb(s,a,o,n,R,t,i,v,e);return arraycopy(R,1,f,0,a),T}function cobylb(r,a,o,f,t,i,v,e,n){var R,s=-1,T=.25,O=2.1,h=.5,P=1.1,u=0,l=0,M=a+1,c=o+1,A=i,b=0,C=!1,D=!1,m=0,g=0,L=0,d=arr(1+f),U=arr2(1+a,1+M),_=arr2(1+a,1+a),x=arr2(1+f,1+M),y=arr2(1+a,1+c),k=arr(1+a),w=arr(1+a),p=arr(1+a),q=arr(1+a),I=arr(1+a);e>=2&&console.log("The initial value of RHO is "+A+" and PARMU is set to zero.");for(var N=0,F=1/A,W=1;a>=W;++W)U[W][M]=t[W],U[W][W]=A,_[W][W]=F;var B=M,E=!1;r:for(;;){if(N>=n&&N>0){s=MaxIterationsReached;break r}++N,u=r(a,o,t,d),l=0;for(var X=1;o>=X;++X)l=Math.max(l,-d[X]);(N==e-1||3==e)&&PrintIterationResult(N,u,l,t,a),d[c]=u,d[f]=l;var Y=!0;if(!E){Y=!1;for(var W=1;f>=W;++W)x[W][B]=d[W];if(M>=N){if(a>=B)if(x[c][M]<=u)t[B]=U[B][M];else{U[B][M]=t[B];for(var X=1;f>=X;++X)x[X][B]=x[X][M],x[X][M]=d[X];for(var X=1;B>=X;++X){U[B][X]=-A,F=0;for(var W=X;B>=W;++W)F-=_[W][X];_[B][X]=F}}if(a>=N){B=N,t[B]+=A;continue r}}E=!0}a:for(;;){o:do{if(!Y){for(var H=x[c][M]+b*x[f][M],V=M,z=1;a>=z;++z)F=x[c][z]+b*x[f][z],H>F?(V=z,H=F):F==H&&0==b&&x[f][z]<x[f][V]&&(V=z);if(a>=V){for(var W=1;f>=W;++W)F=x[W][M],x[W][M]=x[W][V],x[W][V]=F;for(var W=1;a>=W;++W){F=U[W][V],U[W][V]=0,U[W][M]+=F;for(var S=0,X=1;a>=X;++X)U[W][X]-=F,S-=_[X][W];_[V][W]=S}}for(var j=0,W=1;a>=W;++W)for(var z=1;a>=z;++z)F=DOT_PRODUCT(PART(ROW(_,W),1,a),PART(COL(U,z),1,a))-(W==z?1:0),j=Math.max(j,Math.abs(F));if(j>.1){s=DivergingRoundingErrors;break r}for(var X=1;c>=X;++X){d[X]=-x[X][M];for(var z=1;a>=z;++z)I[z]=x[X][z]+d[X];for(var W=1;a>=W;++W)y[W][X]=(X==c?-1:1)*DOT_PRODUCT(PART(I,1,a),PART(COL(_,W),1,a))}C=!0,m=T*A;for(var G=O*A,z=1;a>=z;++z){for(var J=0,X=1;a>=X;++X)J+=_[z][X]*_[z][X];for(var K=0,X=1;a>=X;++X)K+=U[X][z]*U[X][z];k[z]=1/Math.sqrt(J),w[z]=Math.sqrt(K),(k[z]<m||w[z]>G)&&(C=!1)}if(!E&&!C){B=0,F=G;for(var z=1;a>=z;++z)w[z]>F&&(B=z,F=w[z]);if(0==B)for(var z=1;a>=z;++z)k[z]<F&&(B=z,F=k[z]);F=h*A*k[B];for(var X=1;a>=X;++X)q[X]=F*_[B][X];var Q=0,Z=0;R=0;for(var X=1;c>=X;++X)R=DOT_PRODUCT(PART(COL(y,X),1,a),PART(q,1,a)),c>X&&(F=x[X][M],Q=Math.max(Q,-R-F),Z=Math.max(Z,R-F));var $=b*(Q-Z)>2*R?-1:1;F=0;for(var W=1;a>=W;++W)q[W]=$*q[W],U[W][B]=q[W],F+=_[B][W]*q[W];for(var X=1;a>=X;++X)_[B][X]/=F;for(var z=1;a>=z;++z){if(z!=B){F=DOT_PRODUCT(PART(ROW(_,z),1,a),PART(q,1,a));for(var X=1;a>=X;++X)_[z][X]-=F*_[B][X]}t[z]=U[z][M]+q[z]}continue r}if(D=trstlp(a,o,y,d,A,q),!D){F=0;for(var X=1;a>=X;++X)F+=q[X]*q[X];if(.25*A*A>F){E=!0;break o}}R=0;var rr=0;d[c]=0;for(var X=1;c>=X;++X)R=d[X]-DOT_PRODUCT(PART(COL(y,X),1,a),PART(q,1,a)),c>X&&(rr=Math.max(rr,R));g=x[f][M]-rr;var ar=g>0?R/g:0;if(1.5*ar>b){b=2*ar,e>=2&&console.log("Increase in PARMU to "+b);for(var or=x[c][M]+b*x[f][M],z=1;a>=z;++z)if(F=x[c][z]+b*x[f][z],or>F||F==or&&0==b&&x[f][z]<x[f][M])continue a}L=b*g-R;for(var X=1;a>=X;++X)t[X]=U[X][M]+q[X];E=!0;continue r}Y=!1;var fr=x[c][M]+b*x[f][M],tr=u+b*l,ir=fr-tr;0==b&&u==x[c][M]&&(L=g,ir=x[f][M]-l);var vr=0>=ir?1:0;B=0;for(var z=1;a>=z;++z)F=Math.abs(DOT_PRODUCT(PART(ROW(_,z),1,a),PART(q,1,a))),F>vr&&(B=z,vr=F),p[z]=F*k[z];for(var er=P*A,nr=0,z=1;a>=z;++z)if(p[z]>=m||p[z]>=k[z]){if(F=w[z],ir>0){F=0;for(var X=1;a>=X;++X)F+=Math.pow(q[X]-U[X][z],2);F=Math.sqrt(F)}F>er&&(nr=z,er=F)}if(nr>0&&(B=nr),0!=B){F=0;for(var W=1;a>=W;++W)U[W][B]=q[W],F+=_[B][W]*q[W];for(var X=1;a>=X;++X)_[B][X]/=F;for(var z=1;a>=z;++z)if(z!=B){F=DOT_PRODUCT(PART(ROW(_,z),1,a),PART(q,1,a));for(var X=1;a>=X;++X)_[z][X]-=F*_[B][X]}for(var X=1;f>=X;++X)x[X][B]=d[X];if(ir>0&&ir>=.1*L)continue a}}while(!1);if(C){if(v>=A){s=Normal;break r}var Rr=0,sr=0;if(A*=.5,1.5*v>=A&&(A=v),b>0){for(var Tr=0,X=1;c>=X;++X){Rr=x[X][M],sr=Rr;for(var W=1;a>=W;++W)Rr=Math.min(Rr,x[X][W]),sr=Math.max(sr,x[X][W]);o>=X&&.5*sr>Rr&&(F=Math.max(sr,0)-Rr,Tr=0>=Tr?F:Math.min(Tr,F))}0==Tr?b=0:b*Tr>sr-Rr&&(b=(sr-Rr)/Tr)}e>=2&&console.log("Reduction in RHO to "+A+"  and PARMU = "+b),2==e&&PrintIterationResult(N,x[c][M],x[f][M],COL(U,M),a)}else E=!1}}switch(s){case Normal:if(e>=1&&console.log("%nNormal return from subroutine COBYLA%n"),D)return e>=1&&PrintIterationResult(N,u,l,t,a),s;break;case MaxIterationsReached:e>=1&&console.log("%nReturn from subroutine COBYLA because the MAXFUN limit has been reached.%n");break;case DivergingRoundingErrors:e>=1&&console.log("%nReturn from subroutine COBYLA because rounding errors are becoming damaging.%n")}for(var X=1;a>=X;++X)t[X]=U[X][M];return u=x[c][M],l=x[f][M],e>=1&&PrintIterationResult(N,u,l,t,a),s}function trstlp(r,a,o,f,t,i){for(var v=0,e=0,n=0,R=arr2(1+r,1+r),s=arr(2+a),T=arr(2+a),O=arr(1+r),h=arr(1+r),P=arr(2+a),u=arr(2+a),l=a,M=0,c=1;r>=c;++c)R[c][c]=1,i[c]=0;var A=0,b=0;if(a>=1){for(var C=1;a>=C;++C)f[C]>b&&(b=f[C],A=C);for(var C=1;a>=C;++C)u[C]=C,T[C]=b-f[C]}var D=!0;do r:for(;;){(!D||D&&0==b)&&(l=a+1,A=l,u[l]=l,T[l]=0),D=!1;var m=0,g=0,L=0,d=0;a:do{var U=l==a?b:-DOT_PRODUCT(PART(i,1,r),PART(COL(o,l),1,r));if(0==g||m>U?(m=U,e=M,g=3):M>e?(e=M,g=3):--g,0==g)break r;var _=0;if(M>=A){if(M>A){var x=u[A],y=T[A],C=A;do{var k=C+1,w=u[k],p=DOT_PRODUCT(PART(COL(R,C),1,r),PART(COL(o,w),1,r));v=Math.sqrt(p*p+s[k]*s[k]);var q=s[k]/v,I=p/v;s[k]=q*s[C],s[C]=v;for(var c=1;r>=c;++c)v=q*R[c][k]+I*R[c][C],R[c][k]=q*R[c][C]-I*R[c][k],R[c][C]=v;u[C]=w,T[C]=T[k],C=k}while(M>C);u[C]=x,T[C]=y}if(--M,l>a){v=1/s[M];for(var C=1;r>=C;++C)O[C]=v*R[C][M]}else{v=DOT_PRODUCT(PART(O,1,r),PART(COL(R,M+1),1,r));for(var C=1;r>=C;++C)O[C]-=v*R[C][M+1]}}else{for(var w=u[A],C=1;r>=C;++C)h[C]=o[C][w];for(var N=0,C=r;C>M;){for(var p=0,F=0,c=1;r>=c;++c)v=R[c][C]*h[c],p+=v,F+=Math.abs(v);var W=F+.1*Math.abs(p),B=F+.2*Math.abs(p);if((F>=W||W>=B)&&(p=0),0==N)N=p;else{var k=C+1;v=Math.sqrt(p*p+N*N);var q=p/v,I=N/v;N=v;for(var c=1;r>=c;++c)v=q*R[c][C]+I*R[c][k],R[c][k]=q*R[c][k]-I*R[c][C],R[c][C]=v}--C}if(0==N){_=-1;var C=M;do{for(var E=0,X=0,c=1;r>=c;++c)v=R[c][C]*h[c],E+=v,X+=Math.abs(v);var W=X+.1*Math.abs(E),B=X+.2*Math.abs(E);if(W>X&&B>W){if(v=E/s[C],v>0&&u[C]<=a){var Y=T[C]/v;(0>_||_>Y)&&(_=Y)}if(C>=2)for(var H=u[C],c=1;r>=c;++c)h[c]-=v*o[c][H];P[C]=v}else P[C]=0}while(--C>0);if(0>_)break r;for(var C=1;M>=C;++C)T[C]=Math.max(0,T[C]-_*P[C]);if(M>A){var x=u[A],y=T[A],C=A;do{var k=C+1,H=u[k],p=DOT_PRODUCT(PART(COL(R,C),1,r),PART(COL(o,H),1,r));v=Math.sqrt(p*p+s[k]*s[k]);var q=s[k]/v,I=p/v;s[k]=q*s[C],s[C]=v;for(var c=1;r>=c;++c)v=q*R[c][k]+I*R[c][C],R[c][k]=q*R[c][C]-I*R[c][k],R[c][C]=v;u[C]=H,T[C]=T[k],C=k}while(M>C);u[C]=x,T[C]=y}if(v=DOT_PRODUCT(PART(COL(R,M),1,r),PART(COL(o,w),1,r)),0==v)break r;s[M]=v,T[A]=0,T[M]=_}else++M,s[M]=N,T[A]=T[M],T[M]=0;if(u[A]=u[M],u[M]=w,l>a&&w!=l){var C=M-1,p=DOT_PRODUCT(PART(COL(R,C),1,r),PART(COL(o,w),1,r));v=Math.sqrt(p*p+s[M]*s[M]);var q=s[M]/v,I=p/v;s[M]=q*s[C],s[C]=v;for(var c=1;r>=c;++c)v=q*R[c][M]+I*R[c][C],R[c][M]=q*R[c][C]-I*R[c][M],R[c][C]=v;u[M]=u[C],u[C]=w,v=T[C],T[C]=T[M],T[M]=v}if(l>a){v=1/s[M];for(var C=1;r>=C;++C)O[C]=v*R[C][M]}else{w=u[M],v=(DOT_PRODUCT(PART(O,1,r),PART(COL(o,w),1,r))-1)/s[M];for(var C=1;r>=C;++C)O[C]-=v*R[C][M]}}for(var V=t*t,z=0,S=0,c=1;r>=c;++c)Math.abs(i[c])>=1e-6*t&&(V-=i[c]*i[c]),z+=i[c]*O[c],S+=O[c]*O[c];if(0>=V)break r;if(v=Math.sqrt(S*V),Math.abs(z)>=1e-6*v&&(v=Math.sqrt(S*V+z*z)),d=V/(v+z),L=d,l==a){var W=L+.1*b,B=L+.2*b;if(L>=W||W>=B)break a;L=Math.min(L,b)}for(var C=1;r>=C;++C)h[C]=i[C]+L*O[C];if(l==a){n=b,b=0;for(var C=1;M>=C;++C){var w=u[C];v=f[w]-DOT_PRODUCT(PART(COL(o,w),1,r),PART(h,1,r)),b=Math.max(b,v)}}var C=M;do{for(var j=0,G=0,c=1;r>=c;++c)v=R[c][C]*h[c],j+=v,G+=Math.abs(v);var W=G+.1*Math.abs(j),B=G+.2*Math.abs(j);if((G>=W||W>=B)&&(j=0),P[C]=j/s[C],C>=2)for(var w=u[C],c=1;r>=c;++c)h[c]-=P[C]*o[c][w]}while(C-->=2);l>a&&(P[M]=Math.max(0,P[M]));for(var C=1;r>=C;++C)h[C]=i[C]+L*O[C];if(l>M)for(var J=M+1,C=J;l>=C;++C){for(var w=u[C],K=b-f[w],Q=b+Math.abs(f[w]),c=1;r>=c;++c)v=o[c][w]*h[c],K+=v,Q+=Math.abs(v);var W=Q+.1*Math.abs(K),B=Q+.2*Math.abs(K);(Q>=W||W>=B)&&(K=0),P[C]=K}_=1,A=0;for(var C=1;l>=C;++C)P[C]<0&&(v=T[C]/(T[C]-P[C]),_>v&&(_=v,A=C));v=1-_;for(var C=1;r>=C;++C)i[C]=v*i[C]+_*h[C];for(var C=1;l>=C;++C)T[C]=Math.max(0,v*T[C]+_*P[C]);l==a&&(b=n+_*(b-n))}while(A>0);if(L==d)return!0}while(l==a);return!1}function PrintIterationResult(r,a,o,f,t){console.log("NFVALS = "+r+"  F = "+a+"  MAXCV = "+o),console.log("X = "+PART(f,1,t))}function ROW(r,a){for(var o=r[0].length,f=arr(o),t=0;o>t;++t)f[t]=r[a][t];return f}function COL(r,a){for(var o=r.length,f=arr(o),t=0;o>t;++t)f[t]=r[t][a];return f}function PART(r,a,o){for(var f=arr(o-a+1),t=0,i=a;o>=i;++i,++t)f[t]=r[i];return f}function FORMAT(r){for(var a="",o=0;o<r.length;++o)a+=", ",r[o];return a}function DOT_PRODUCT(r,a){for(var o=0,f=0;f<r.length;++f)o+=r[f]*a[f];return o}var Normal=0,MaxIterationsReached=1,DivergingRoundingErrors=2;